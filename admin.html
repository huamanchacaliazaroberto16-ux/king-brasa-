<!DOCTYPE html>
<html lang="es">
<head>
  <link rel="icon" href="imagenes/logo-kingbrasa.png">
  <meta charset="UTF-8">
  <title>Panel Admin · King Brasa</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="script.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body onload="adminInit()">
  
  <!-- Header -->
  <header>
    <h2>King Brasa</h2>
    <button class="hamburger" id="hamburgerBtn" aria-label="Menú">
      <i class="fas fa-bars"></i>
    </button>
    <nav class="nav-buttons" id="navMenu">
      <a href="menu principal.html"><i class="fas fa-home"></i> Inicio</a>
      <a href="Cmenu.html"><i class="fas fa-utensils"></i> Carta</a>
      <a href="nosotros.html"><i class="fas fa-users"></i> Nosotros</a>
      
      <span id="adminBtnContainer"></span>
      <span id="userBtns"></span>
    </nav>
  </header>

  <!-- Sección: Editar Menú -->
  <section class="fade-in">
    <h2><i class="fas fa-utensils"></i> Editar Menú</h2>
    <form id="formAdd" onsubmit="event.preventDefault(); addItem()"
          style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem;margin-bottom:2rem;">
      <input name="nombre" required placeholder="Nombre del plato">
      <input name="precio" required type="number" step="0.01" placeholder="Precio (S/)">
      <select name="cat" required>
        <option value="">Seleccionar categoría</option>
        <option value="Pollos">Pollos</option>
        <option value="Entradas">Entradas</option>
        <option value="Parrillas">Parrillas</option>
        <option value="Bebidas">Bebidas</option>
        <option value="Postres">Postres</option>
      </select>
      <input id="newCatInput" placeholder="Nueva categoría">
      <button type="button" onclick="addCategoria()" class="btn outline">
        <i class="fas fa-plus"></i> Añadir categoría
      </button> 
      <input name="img" placeholder="URL imagen (opcional)">
      <textarea name="descripcion" placeholder="Descripción del plato (opcional)" rows="2"></textarea>
      <button class="btn" type="submit">
        <i class="fas fa-plus-circle"></i> Añadir Plato
      </button>
    </form>

    <table>
      <thead>
        <tr>
          <th>Imagen</th>
          <th>Nombre</th>
          <th>Precio</th>
          <th>Categoría</th>
          <th>Descripción</th>
          <th>Acción</th>
        </tr>
      </thead>
      <tbody id="tbodyMenu"></tbody>
    </table>
  </section>

  <!-- Sección: Pedidos Recibidos -->
  <section class="fade-in">
    <h2><i class="fas fa-shopping-bag"></i> Pedidos Recibidos</h2>
    <table>
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Teléfono</th>
          <th>Dirección</th>
          <th>Método</th>
          <th>Fecha</th>
          <th>Platos</th>
          <th>Total</th>
          <th>Acción</th>
        </tr>
      </thead>
      <tbody id="tbodyPedidos"></tbody>
    </table>
  </section>

  <!-- Sección: Estadísticas - Gráfico -->
  <section class="fade-in" id="graficoPedidosSection" style="display:none;">
    <h2><i class="fas fa-chart-bar"></i> Pedidos por Categoría</h2>
    <div style="max-width: 600px; margin: 0 auto;">
      <canvas id="graficoPedidos"></canvas>
    </div>
  </section>

  <!-- Script de autenticación -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const user = JSON.parse(localStorage.getItem('cepasSession') || 'null');

      // Verificar si es admin
      if (!user || !user.admin) {
        alert('⚠️ Acceso denegado. Solo administradores pueden acceder a esta página.');
        window.location.href = 'menu principal.html';
        return;
      }

      const adminContainer = document.getElementById('adminBtnContainer');
      const userBtnsContainer = document.getElementById('userBtns');

      // Mostrar botón Admin
      if (user?.admin && adminContainer) {
        const adminBtn = document.createElement('a');
        adminBtn.href = 'admin.html';
        adminBtn.innerHTML = `<i class="fas fa-user-shield"></i> Admin`;
        adminContainer.appendChild(adminBtn);
      }

      // Mostrar botón Cerrar sesión
      if (user && userBtnsContainer) {
        const logoutBtn = document.createElement('button');
        logoutBtn.className = 'btn outline';
        logoutBtn.innerHTML = `<i class="fas fa-sign-out-alt"></i> Cerrar sesión`;
        logoutBtn.onclick = logout;
        userBtnsContainer.appendChild(logoutBtn);
      }
    });

    function logout() {
      localStorage.removeItem('cepasSession');
      window.location.href = 'menu principal.html';
    }
  </script>

</body>
</html>
